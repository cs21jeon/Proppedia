# Propedia 업데이트 이력

모든 주요 변경 사항이 이 파일에 기록됩니다.

형식: [Keep a Changelog](https://keepachangelog.com/ko/1.0.0/)

---

## [1.0.2+7] - 2026-03-01

### 개선
- **신규 행정구역 토지정보 조회 지원** (서버)
  - 동탄구 신동 등 신규 행정구역의 토지 정보 조회 가능
  - getLandCharacteristics API 실패 시 ladfrlList + getLandUseAttr API 자동 대체
  - 지목, 면적, 용도지역 정상 표시
  - 예: 신동 822 → 지목: 대, 면적: 91,811㎡, 용도지역: 제3종일반주거지역
- **건물 없는 토지의 도로명주소 표시**
  - 건축물대장에 등록되지 않은 토지도 도로명주소 조회 가능
  - juso.go.kr API를 통한 지번→도로명주소 변환
  - 예: 신동 822 → 경기도 화성시 동탄구 동탄신리천로8길 46 (신동)
- **법정동 검색 결과 정렬 개선**
  - 정확한 동 이름 매칭 우선 표시 (예: "신동" 검색 시 신동 > 신동읍 > 서신동)
  - 동탄구 신동 등 신규 행정구역이 상위에 표시됨
- **법정동 선택 UI 개선**
  - 최대 5개 항목 높이 제한 + 내부 스크롤
  - 50개 결과도 컴팩트하게 표시
- **지번 존재 여부 필터링**
  - "신동 822" 검색 시 822번지가 있는 법정동만 표시
  - juso.go.kr API로 병렬 검증 (약 2초)
  - 불필요한 선택지 제거로 UX 개선
- **신규 행정구역 주소 표시 개선**
  - 화성시 동탄구/만세구/효행구/병점구 주소에 구 이름 자동 삽입
  - "경기도 화성시 오산동" → "경기도 화성시 동탄구 오산동"
  - 건축물대장 plat_plc, new_plat_plc 주소 자동 보정
- **법정동 검색 결과 정규화**
  - "화성시동탄구" → "화성시 동탄구" 띄어쓰기 정규화
  - 검색 결과에 정규화된 전체 주소 표시
- **지도 마커 라벨 개선**
  - 지번만 표시 → "동+지번" 형태로 변경 (예: "오산동 988")

### 버그 수정
- **Regex 백레퍼런스 버그 수정** (서버)
  - 문제: `f'\1 {district}'`가 SOH 제어문자(\x01)로 해석됨
  - 해결: `r'\1' + f' {district}'` raw string 사용
- **오산동 법정동코드 누락 수정** (DB)
  - 4159710400 (동탄구 오산동) 레코드 추가
  - old_bjdong_code: 4159012900 매핑
- **VWorld 토지 정보 없는 지번 검색 실패 수정** (앱)
  - 문제: VWorld API에 토지 데이터 없으면 "해당 지번을 찾을 수 없습니다" 표시
  - 해결: 도로명주소(juso.go.kr)가 확인되면 유효한 결과로 인정
  - 예: 신동 822 - VWorld 토지 정보 없지만 도로명주소로 결과 표시

### 서버
- **VWorld API 대체 조회 로직** (vworld_service.py)
  - `_get_land_characteristics()`: 기존 getLandCharacteristics API
  - `_get_land_from_ladfrl()`: 토지임야대장 API (지목, 면적)
  - `_get_land_use_attr()`: 토지이용계획 API (용도지역)
  - getLandCharacteristics 실패 시 자동 fallback
- `_inject_new_district_name()` 함수 추가 (app_api.py)
- `get_road_address_by_jibun()` 함수 추가 (address_finder_service.py)
- 건물 데이터 없을 때 juso.go.kr API로 도로명주소 조회
- 정규화된 시군구명 검색 쿼리 지원 (bjdong_service.py)
- 법정동 검색 결과 정렬 개선: 정확한 동 이름 매칭 우선
- `search_address_with_jibun_check()`: 지번 존재 여부 검증 (juso.go.kr)
- `get_total_land_area()` 신코드 사용으로 변경 (app_api.py)

---

## [1.0.2+6] - 2026-02-26

### 개선
- **스켈레톤 로딩 UI 추가** (Flutter 앱 & PWA)
  - 로딩 중 실제 결과 화면과 유사한 스켈레톤 UI 표시
  - Shimmer 효과로 로딩 진행 중임을 시각적으로 표현
- **시간 기반 단계별 진행 메시지**
  - 0~3초: 건축물 정보 조회 중...
  - 3~8초: 토지 정보 확인 중...
  - 8~15초: 전유부 정보 조회 중...
  - 15~25초: 대지지분 계산 중...
  - 25~40초: 데이터 정리 중...
  - 40초+: 거의 완료되었습니다...
- **API 타임아웃 연장** (30초 → 60초)
  - 대규모 아파트 조회 시 타임아웃 방지
- **에러 화면 개선**
  - "다시 시도" 버튼 추가
  - 네트워크 오류 안내 문구 추가

### 버그 수정
- 화성시 신규 행정구역 검색 오류 수정 (동탄구/병점구/효행구/만세구)
  - 문제: 청계동, 오산동 등 동탄구 내 동 검색 시 토지 정보 조회 실패
  - 원인: old_bjdong_code 매핑 누락 (영천동만 매핑되어 있었음)
  - 해결: 화성시 신규 행정구역 25개 동에 대한 old_bjdong_code 매핑 추가
  - 적용 범위: 동탄구 14개동, 병점구 9개동, 효행구 2개동, 만세구 1개동

### 서버
- **법정동 코드 업데이트 스크립트 v2** (자동 매핑 기능 추가)
  - 신규 행정구역 INSERT 시 `old_bjdong_code` 자동 매핑
  - 동일 시도 내 같은 동명의 폐지 코드를 찾아 자동 연결
  - `--fill-mappings` 옵션으로 기존 누락 매핑 보완
  - cron 업데이트: 매일 02:30 자동 실행

---

## [1.0.2+5] - 2026-02-25

### 개선
- API 병렬 호출 방식 적용
  - 건물정보, 부속지번, 법정동 주소 동시 조회 (Phase 1)
  - 의존성 있는 API는 순차 처리 유지 (Phase 2)
  - 예상 응답시간 30-50% 단축
- **건축물대장 TTL 캐싱 추가**
  - 총괄표제부/표제부: 1시간 캐시 (maxsize=500)
  - 전유부: 1시간 캐시 (maxsize=200, 대용량 데이터)
  - 재조회 시 90% 응답시간 단축
- **VWorld API 호출 최적화**
  - 1-3월에는 전년도 데이터부터 조회 (공시가격 3-4월 발표 고려)
  - 첫 조회 시 불필요한 API 호출 1회 감소
- PWA 앱 Flutter 앱과 동기화
  - 하단 네비게이션 4탭 통일 (홈/검색기록/즐겨찾기/프로필)
  - 로그인 모달 다이얼로그 구현
  - 검색기록 최신순 정렬
  - 다크모드 지원 추가

### 버그 수정
- 도로명 검색 결과 조회 시 `address_info` 미정의 오류 수정
  - `search_by_bdmgtsn` 함수에 누락된 법정동 주소 조회 추가
  - 병렬 처리 적용 시 발생한 변수명 오류 수정
- 신규 행정구역 지도 검색 시 PDF 파일명 주소 누락 수정
  - 문제: 지도 검색(역지오코딩)에서 구 법정동코드 반환 시 주소 조회 실패
  - 해결: `get_new_bjdong_code()` 함수로 구 코드 → 신 코드 자동 변환
  - 결과: PDF 파일명에 정확한 주소 표시 (예: `경기도 화성시동탄구 영천동_756-4_...`)

---

## [1.0.2+4] - 2026-02-24

### 개선
- VWorld API TTL 캐싱 적용
  - 토지 정보: 24시간 캐시 (재조회 시 90% 속도 향상)
  - 공시가격: 7일 캐시 (연 1회 변경되는 데이터)
- 캐시 상태 확인 API 추가 (`/app/api/cache/status`)

### 버그 수정
- 화성시 동탄구/만세구/병점구/효행구 등 신규 행정구역 검색 오류 수정
  - 문제: 도로명/지번 검색 시 데이터 조회 실패 및 지도 표시 안됨
  - 원인: 공공데이터포털/VWorld API는 구 법정동코드, DB는 신 코드 사용
  - 해결:
    - 표시용(신 코드 `admCd`)과 API호출용(구 코드 `bdMgtSn`) 분리
    - 도로명 검색 → 결과 페이지 `admCd` 파라미터 전달
    - 동/호 상세 조회 API에 `api_bjdong_code` 추가
    - 지도 표시: 도로명주소(`new_plat_plc`) 우선 지오코딩
    - **지번 검색: `old_bjdong_code` 매핑으로 VWorld API 구 코드 자동 사용**

### 문서
- API 성능 최적화 방안 문서 추가 (`docs/api-performance-optimization.md`)
- `/develop` 슬래시 명령어 추가 (개발→테스트→릴리즈 자동화)
- 테스트 케이스 개선: 건물/토지 정보 유무 검증, 도로명 검색 확인, 신규 행정구역 케이스 추가

---

## [1.0.2+3] - 2026-02-23

### 개선
- 대규모 아파트 동/호 목록 지원 확대 (최대 20,000세대)
- VWorld API 우선 조회로 대지지분 조회 속도 개선 (3분 → 30초)
- API 타임아웃 15초 → 30초 증가 (대규모 아파트 대응)
- 대지지분 계산 페이지 제한 확대 (최대 40,000개)

### 버그 수정
- 부속지번 체크 로직 제거로 VWorld API 정상 동작
- 공공데이터 API 페이지당 100개 제한 대응

### 서버
- `building_unified_service.py` 최적화
- 랜딩 페이지 스크린샷 갤러리 스크롤 수정

---

## [1.0.2+2] - 2026-02-19

### 개선
- 지번 검색 UX 개선
- 버튼 클릭 방식 변경

### 버그 수정
- 지번 파싱 버그 수정

---

## [1.0.2+1] - 2026-02-19

### 개선
- 로그인 필수 기능 강화
- 지번 검색 UX 개선

---

## [1.0.1] - 2026-02-18

### 추가
- 초기 릴리즈
- 도로명/지번/지도 검색
- 토지/건물 정보 조회
- PDF 저장 및 공유
- 즐겨찾기/검색기록

---

## 버전 형식

`X.Y.Z+N`
- **X**: 주요 버전 (Major) - 호환성 깨지는 변경
- **Y**: 부 버전 (Minor) - 기능 추가
- **Z**: 패치 (Patch) - 버그 수정
- **N**: 빌드 번호 - Play Store 업로드마다 증가
